<!DOCTYPE html>
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<html lang="en" xmlns:th="https://www.thymeleaf.org">
<head th:replace="common/header :: mainHead"></head>
<body style="background-color:#661BD1;">
<div class="totalWrap upload" id="totalWrap" style="background-color: #fff;">

    <div class="body_wrap">
        <!-- header -->
        <div style="text-align: center; padding-top:40px;">
            <img th:src="@{/assets/images/logo.png}" alt="" width="553px" height="200px">
        </div>
        <div class="logo" style="text-align: center; margin-top:40px; margin-bottom:40px;">
            <img th:src="@{/assets/images/whale_flow.png}" alt="" width="50px" height="50px">
        </div>

            <!-- body -->
            <div class="find_wrap">
                <div>
                    <div>
                        <div style="padding:0px 50px;">
                            <h4>아이디 찾기</h4>
                            <hr>
                        </div>
                        <div style="padding:10px 50px;">
                            <form role="form">
                                <div>
                                    <label for="findIdUserEmail">이메일</label>
                                    <input type="text" class="input_row inline_div middle_row" id="findIdUserEmail" placeholder="가입시 등록한 이메일을 입력하세요.">
                                </div>
                                <button type="button" class="btn-block login-button" id="findIdCheckEmail">아이디 인증메일 발송</button>
                            </form>
                        </div>
                    </div>

                    <!-- Modal content-->
                    <div>
                        <div style="padding:0px 50px;">
                            <h4>비밀번호 찾기</h4>
                            <hr>
                        </div>
                        <div style="padding:10px 50px;">
                            <form role="form">
                                <div class="form-group">
                                    <label for="userEmail">이메일</label>
                                    <input type="text" class="input_row inline_div middle_row" id="userEmail" placeholder="가입시 등록한 이메일을 입력하세요.">
                                </div>
                                <div class="form-group">
                                    <label for="userName">아이디</label>
                                    <input type="text" class="input_row inline_div middle_row" id="userName" placeholder="가입시 등록한 아이디를 입력하세요.">
                                </div>
                                <button type="button" class="btn-block login-button" id="checkEmail">비밀번호 인증메일 발송</button>
                            </form>
                            <hr>
                            <div id="checkMsg" style="color: red"></div>
                        </div>
                    </div>

                </div>
            </div>
    </div>
</div>
<script type="text/javascript">

    $("#checkEmail").click(function () {
        let userEmail = $("#userEmail").val();
        let userName = $("#userName").val();

        $.ajax({
            type: "GET",
            url: "/account/check/findPw",
            data: {
                "userEmail": userEmail,
                "userName": userName
            },
            success: function (res) {
                if (res['check']) {
                    swal("발송 완료!", "입력하신 이메일로 임시비밀번호가 발송되었습니다.", "success")
                        .then((OK) => {
                            if(OK) {
                                $.ajax({
                                    type: "POST",
                                    url: "/account/check/findPw/sendEmail",
                                    data: {
                                        "userEmail": userEmail,
                                        "userName": userName
                                    }
                                });
                                window.location.href = "/";
                            }
                        }
                    )
                    $('#checkMsg').html('<p style="color:darkblue"></p>');
                } else {
                    $('#checkMsg').html('<p style="color:red">일치하는 정보가 없습니다.</p>');
                }
            }
        });
    });
</script>
</body>
</html>